From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Ivan Pekov <ivan@mrivanplays.com>
Date: Mon, 23 Jan 2023 18:39:49 +0200
Subject: [PATCH] Remove duplicated component


diff --git a/src/main/java/puregero/multipaper/externalserverprotocol/EntityUpdateNBTPacket.java b/src/main/java/puregero/multipaper/externalserverprotocol/EntityUpdateNBTPacket.java
index 2b9772a0a9fa60794d27cdcb632e6d26f0dd32e5..1661ffa3d16bb6fd34d0cb2218a309fbdc440bb0 100644
--- a/src/main/java/puregero/multipaper/externalserverprotocol/EntityUpdateNBTPacket.java
+++ b/src/main/java/puregero/multipaper/externalserverprotocol/EntityUpdateNBTPacket.java
@@ -86,6 +86,7 @@ public class EntityUpdateNBTPacket extends ExternalServerPacket {
         }
 
         Entity entity = level.entityManager.knownUuids.get(uuid);
+        boolean loadedRecursive = false;
 
         if (entity == null) {
             entity = EntityType.loadEntityRecursive(tag, level, entity2 -> {
@@ -99,6 +100,7 @@ public class EntityUpdateNBTPacket extends ExternalServerPacket {
                     return null;
                 }
             });
+            loadedRecursive = true;
         } else if (entity instanceof ServerPlayer player) {
             new Exception("Tried to update the nbt of player " + player.getScoreboardName() + " to " + tag).printStackTrace();
         } else {
@@ -108,6 +110,7 @@ public class EntityUpdateNBTPacket extends ExternalServerPacket {
             }
         }
 
+        if (!loadedRecursive) {
         if (tag.contains("Passengers", 9)) {
             ListTag nbttaglist = tag.getList("Passengers", 10);
 
@@ -120,6 +123,7 @@ public class EntityUpdateNBTPacket extends ExternalServerPacket {
                 }
             }
         }
+        }
 
         if (entity instanceof Mob mob) mob.restoreLeashFromSave();
 
